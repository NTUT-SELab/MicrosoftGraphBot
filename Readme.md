# MicrosoftGraphBot

Microsoft Graph API æ˜¯ä¸€å€‹ RESTful çš„ Web APIï¼Œå¯è®“æ‚¨å­˜å– Microsoft Cloud æœå‹™è³‡æºã€‚ è¨»å†Šæ‡‰ç”¨ç¨‹å¼ä¸¦å–å¾—ä½¿ç”¨è€…æˆ–æœå‹™çš„é©—è­‰æ¬Šæ–ä¹‹å¾Œï¼Œæ‚¨å°±å¯ä»¥å° Microsoft Graph API æå‡ºè¦æ±‚ã€‚ 

è—‰ç”±æœ¬å°ˆæ¡ˆå»ºç«‹è‡ªå‹•åŒ–è§¸ç™¼ Microsoft Graph API æ©Ÿå™¨äººä¼ºæœå™¨ï¼Œæ»¿è¶³å¾®è»Ÿ Office365 é–‹ç™¼è€…è¨‚é–±çºŒç´„æ¢ä»¶ä¸¦è‡ªå‹•çºŒç´„ï¼Œè©²æ©Ÿå™¨äººæœƒæ ¹æ“šçµ„æ…‹æª”çš„è¨­å®šæ’æˆè§¸ç™¼ Microsoft Graph APIã€‚

æ‡‰ç”¨: [Office365 é–‹ç™¼è€…è¨‚é–±](https://developer.microsoft.com/en-us/microsoft-365/dev-program) ğŸ˜˜

||Ubuntu|Windows|MacOS|
|----|----|----|----|
|master|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=master&jobname=Build%20and%20test%20project%20on%20Ubuntu%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=master)|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=master&jobname=Build%20and%20test%20project%20on%20Windows%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=master)|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=master&jobname=Build%20and%20test%20project%20on%20MacOS%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=master)|
|develop|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=develop&jobname=Build%20and%20test%20project%20on%20Ubuntu%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=develop)|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=develop&jobname=Build%20and%20test%20project%20on%20Windows%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=develop)|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=develop&jobname=Build%20and%20test%20project%20on%20MacOS%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=develop)|
|hotfix|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=hotfix&jobname=Build%20and%20test%20project%20on%20Ubuntu%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=hotfix)|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=hotfix&jobname=Build%20and%20test%20project%20on%20Windows%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=hotfix)|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=hotfix&jobname=Build%20and%20test%20project%20on%20MacOS%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=hotfix)|
|document|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=document&jobname=Build%20and%20test%20project%20on%20Ubuntu%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=document)|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=document&jobname=Build%20and%20test%20project%20on%20Windows%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=document)|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=document&jobname=Build%20and%20test%20project%20on%20MacOS%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=document)|
|release|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=release&jobname=Build%20and%20test%20project%20on%20Ubuntu%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=release)|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=release&jobname=Build%20and%20test%20project%20on%20Windows%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=release)|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=release&jobname=Build%20and%20test%20project%20on%20MacOS%20platform)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=release)|

||master|develop|hotfix|document|release|
|----|----|----|----|----|----|
|CodeQL|![CodeQL](https://github.com/NTUT-SELab/MicrosoftGraphBot/workflows/CodeQL/badge.svg?branch=master)|![CodeQL](https://github.com/NTUT-SELab/MicrosoftGraphBot/workflows/CodeQL/badge.svg?branch=develop)|![CodeQL](https://github.com/NTUT-SELab/MicrosoftGraphBot/workflows/CodeQL/badge.svg?branch=hotfix)|![CodeQL](https://github.com/NTUT-SELab/MicrosoftGraphBot/workflows/CodeQL/badge.svg?branch=document)|![CodeQL](https://github.com/NTUT-SELab/MicrosoftGraphBot/workflows/CodeQL/badge.svg?branch=release)|
|Coverage|[![Azure DevOps coverage (branch)](https://img.shields.io/azure-devops/coverage/KennethTang/github/9/master)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=master)|[![Azure DevOps coverage (branch)](https://img.shields.io/azure-devops/coverage/KennethTang/github/9/develop)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=develop)|[![Azure DevOps coverage (branch)](https://img.shields.io/azure-devops/coverage/KennethTang/github/9/hotfix)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=hotfix)|[![Azure DevOps coverage (branch)](https://img.shields.io/azure-devops/coverage/KennethTang/github/9/document)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=document)|[![Azure DevOps coverage (branch)](https://img.shields.io/azure-devops/coverage/KennethTang/github/9/release)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=release)|

||Github|Docker|
|----|----|----|
|Publish|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=release&stagename=Publish%20the%20current%20version%20to%20Github)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=release)|[![Build Status](https://dev.azure.com/KennethTang/Github/_apis/build/status/NTUT-SELab.MicrosoftGraphBot?branchName=release&stagename=Publish%20the%20current%20version%20to%20Dockerhub)](https://dev.azure.com/KennethTang/Github/_build/latest?definitionId=9&branchName=release)|

## æ•™å­¸:
  - [ç¶å®š Office 365 æˆæ¬Šæ•™å­¸](./Docs/Bind.md)
  - [Azure æ‡‰ç”¨ç¨‹å¼è¨»å†Šæ•™å­¸](./Docs/AppRegistrations.md)

## çµ„æ…‹æª”ä»‹ç´¹:

ç¯„ä¾‹æ–‡ä»¶: [appsettings.json.example](appsettings.json.example)
```
{
  "JoinBotMessage": "æ­¡è¿ä½¿ç”¨ Microsoft Graph Bot",
  "Cron": "0 */4 * * *",
  "AdminPassword": "P@ssw0rd",
  "Telegram": {
    "Token": "1119104861:AAH4D1-ZdtwvFPeQARLJAdhBYPA1xK7px08"
  },
  "MSSQL": {
    "Host": "mssql",
    "Port": 1433,
    "User": "sa",
    "Password": "P@ssw0rd",
    "DataBase": "MicrosoftGraphBot"
  },
  "API": {
    "NumberOfServiceCall": 0,
    "NumberOfMethodCall": 0
  }
}
```

||é…ç½®é …|èªªæ˜|
|----|----|----|
||JoinBotMessage|ä½¿ç”¨è€…ç¬¬ä¸€æ¬¡èˆ‡ Bot å»ºç«‹è¯ç¹«æ™‚ï¼ŒBotçš„å•å€™èª|
||Cron|Api æ’ç¨‹è§¸ç™¼çš„é »ç‡ï¼Œè«‹åƒè€ƒ Crontab æ ¼å¼|
||CheckVerCron|æª¢æŸ¥ **Bot** æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬çš„é »ç‡ï¼Œè«‹åƒè€ƒ Crontab æ ¼å¼|
||AdminPassword|ç®¡ç†è€…å¯†ç¢¼ï¼Œèˆ‡ Bot æºé€šå¾Œï¼Œè¼¸å…¥æ­¤å¯†ç¢¼å¯å–å¾—ç®¡ç†è€…æ¬Šé™|
|Telegram|Token|Telegram bot tokenï¼Œè«‹èˆ‡ [Telegram bot father](https://core.telegram.org/bots) èŠå¤©å»ºç«‹ Telegram bot ä¸¦å–å¾— Token|
|MSSQL|Host|SQL server ä¸»æ©Ÿä½ç½® (å‚™è¨»:ä½¿ç”¨ Docker compose åœ¨ MSSQL é …ä¸éœ€è¦åšä»»ä½•æ›´æ”¹)|
||Port|SQL server port|
||User|SQL server ä½¿ç”¨è€…|
||Password|SQL server ä½¿ç”¨è€…çš„å¯†ç¢¼|
||DataBase|è³‡æ–™åº«åç¨±|
|API|NumberOfServiceCall|æ¯æ¬¡å‘¼å« API æ™‚ï¼Œå‘¼å« API ç¨®é¡æ•¸é‡çš„ä¸Šé™ ä¾‹å¦‚: Outlook API (å‚™è¨»: 0 ç‚ºæ‰€æœ‰ API ç¨®é¡)|
||NumberOfMethodCall|æŸå€‹ API ç¨®é¡ï¼Œå‘¼å« API æ•¸é‡çš„ä¸Šé™ ä¾‹å¦‚: List messages (å‚™è¨»: 0 ç‚ºæŸå€‹ API ç¨®é¡ä¸­ï¼Œæ‰€æœ‰çš„ API)|

## æ¶è¨­æ–¹æ³•:
è‡³ [Github Release](https://github.com/NTUT-SELab/MicrosoftGraphBot/releases) ä¸‹è¼‰æœ€æ–°çš„ appsettings.json(æ‡‰ç”¨ç¨‹å¼é…ç½®æ–‡ä»¶)ï¼Œç·¨è¼¯å…¶å…§å®¹ã€‚ å‚™è¨»: [Telegram:Token] è«‹æ”¹æˆè‡ªå·± **Bot** çš„ Tokenã€‚

### Docker(æ¨è–¦):
1. è‡³ [Github Release](https://github.com/NTUT-SELab/MicrosoftGraphBot/releases) ä¸‹è¼‰æœ€æ–°çš„ **docker.tar.gz**ï¼Œä¸¦è§£å£“ç¸®æ–‡ä»¶
1. å®‰è£ [Docker](https://docs.docker.com/engine/install/#supported-platforms)

- Windows
    1. é–‹å•Ÿ Powershellï¼Œä¸¦åˆ‡æ›è‡³ **docker.tar.gz** è§£å£“ç¸®å¾Œçš„ç›®éŒ„
    1. ç¬¬ä¸€æ¬¡åŸ·è¡Œéœ€è¦å»ºç«‹å¿…è¦è³‡æ–™å¤¾
        ```
        PS C:\docker> .\CreateContainerFolder.ps1
        ```
    1. å°‡ appsettings.json ç§»å‹•è‡³ docker è³‡æ–™å¤¾ä¸‹çš„ bot è³‡æ–™å¤¾å…§
    1. ç·¨è¼¯ appsettings.json æ–‡ä»¶çš„å…§å®¹
    1. å»ºç«‹ä¸¦å•Ÿå‹•å®¹å™¨
        ```
        PS C:\docker> docker-compose up -d
        ```    

- Linux & MacOS
    1. åˆ‡æ›è‡³ **docker.tar.gz** è§£å£“ç¸®å¾Œçš„ç›®éŒ„
    1. ç¬¬ä¸€æ¬¡åŸ·è¡Œéœ€è¦å»ºç«‹å¿…è¦è³‡æ–™å¤¾
        ```
        root@docker_server:~/docker$ ./CreateContainerFolder.sh
        ```
    1. å°‡ appsettings.json ç§»å‹•è‡³ docker è³‡æ–™å¤¾ä¸‹çš„ bot è³‡æ–™å¤¾å…§
    1. ç·¨è¼¯ appsettings.json æ–‡ä»¶çš„å…§å®¹
    1. å»ºç«‹ä¸¦å•Ÿå‹•å®¹å™¨
        ```
        root@docker_server:~/docker$ docker-compose up -d
        ```

- æ›´æ–°ç‰ˆæœ¬æ–¹æ³•
  ```
  docker-compose down
  docker-compose pull
  docker-compose up -d
  ```

### å…¶å®ƒ
1. è‡ªè¡Œå®‰è£ [SQL server](https://www.microsoft.com/zh-tw/sql-server/sql-server-downloads)
1. ç·¨è¼¯ **appsettings.json** å…§ MSSQL é…ç½®é …çš„é…ç½®

- Windows(x64):
  1. è‡³ [Github Release](https://github.com/NTUT-SELab/MicrosoftGraphBot/releases) ä¸‹è¼‰æœ€æ–°çš„ **win-x64.zip**ï¼Œä¸¦è§£å£“ç¸®æ–‡ä»¶
  1. åŸ·è¡Œ **MicrosoftGraphAPIBot.exe**

- Linux(x64):
  1. è‡³ [Github Release](https://github.com/NTUT-SELab/MicrosoftGraphBot/releases) ä¸‹è¼‰æœ€æ–°çš„ **linux-x64.zip**ï¼Œä¸¦è§£å£“ç¸®æ–‡ä»¶
  1. åŸ·è¡Œ **MicrosoftGraphAPIBot**
      ```
      root@server:~/MicrosoftGraphAPIBot$ ./MicrosoftGraphAPIBot
      ```

- MacOS(x64):
  1. è‡³ [Github Release](https://github.com/NTUT-SELab/MicrosoftGraphBot/releases) ä¸‹è¼‰æœ€æ–°çš„ **osx-x64.zip**ï¼Œä¸¦è§£å£“ç¸®æ–‡ä»¶
  1. åŸ·è¡Œ **MicrosoftGraphAPIBot**
      ```
      root@server:~/MicrosoftGraphAPIBot$ ./MicrosoftGraphAPIBot
      ```

## æ”¯æ´ API:
**æœªä¾†é‚„æœƒæŒçºŒæ›´æ–°æ–°çš„Api**

### [Outlook API](https://github.com/NTUT-SELab/MicrosoftGraphBot/issues/3):
- List messages
- Create Message
- Get message
- Update message
- Delete message
- message: send

### [OneDrive API](https://github.com/NTUT-SELab/MicrosoftGraphBot/issues/9)
- List children of a driveItem
- Create a new folder in a drive
- Update DriveItem properties
- Delete a DriveItem
- Move a DriveItem to a new folder

### [Permissions API](https://github.com/NTUT-SELab/MicrosoftGraphBot/issues/11)
- Create a sharing link for a DriveItem
- Accessing shared DriveItems
- List sharing permissions on a driveItem
- Get sharing permission for a file or folder
- Update sharing permission
- Delete a sharing permission from a file or folder

### [Calendar API](https://github.com/NTUT-SELab/MicrosoftGraphBot/issues/12)
- List calendars
- Create Calendar
- Update calendar
- Delete calendar

## ç‰ˆæœ¬:
è«‹è‡³ [ReleaseNotes](./ReleaseNotes) è³‡æ–™å¤¾æŸ¥çœ‹è®Šæ›´ç´€éŒ„ã€‚


## è²¢ç»:
æˆ‘å€‘å°‡è²¢ç»åˆ†ç‚º3é¡:
1. æå‡ºåŠŸèƒ½éœ€æ±‚ï¼Œä½†ç„¡æ’°å¯«ç¨‹å¼èƒ½åŠ›
    - é–‹å•Ÿæ–°çš„ issueï¼Œä¸¦ä½¿ç”¨ **åŠŸèƒ½è¦æ±‚** æ¨¡æ¿

1. æå‡ºéŒ¯èª¤å ±å‘Šï¼Œä½†ç„¡æ’°å¯«ç¨‹å¼èƒ½åŠ›
    - é–‹å•Ÿæ–°çš„ issueï¼Œä¸¦ä½¿ç”¨ **éŒ¯èª¤å ±å‘Š** æ¨¡æ¿

1. æœ‰æ’°å¯«ç¨‹å¼èƒ½åŠ›è€…
    - è«‹åƒè€ƒ [Contributing.md](./Docs/Contributing.md)

## æŠ€è¡“:
- C#
- Dependency injection
- Entity Framework Core
- Microsoft Graph API
- Telegram API
- Hangfire (æ’ç¨‹)
